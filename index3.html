<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuel Request System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass-morphism {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Automatically capitalize lorry number input */
        .uppercase-input {
            text-transform: uppercase;
        }
    </style>
</head>

<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-md w-full glass-morphism rounded-2xl shadow-2xl p-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-slate-800">Fuel Request</h1>
            <p class="text-slate-500">Please fill in the details for verification</p>
        </div>

        <form id="fuelForm" class="space-y-4">
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">Driver ID</label>
                <input type="text" name="DriverID" required placeholder="e.g. DRV-9921"
                    class="w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
            </div>

            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">Lorry Number</label>
                <input type="text" name="LorryNumber" required placeholder="e.g. LP-4452"
                    class="w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all uppercase-input">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-1">Vehicle Mileage</label>
                    <input type="number" name="Mileage" required placeholder="KM"
                        class="w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-1">Liters Needed</label>
                    <input type="number" name="RequiredLiters" required placeholder="Liters"
                        class="w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                </div>
            </div>

            <div>
                <label class="block text-sm font-semibold text-blue-600 mb-1">Meter Reading Photo</label>
                <div
                    class="relative border-2 border-dashed border-slate-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors bg-white">
                    <input type="file" id="photoInput" accept="image/*" capture="environment"
                        class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">

                    <div id="photoPlaceholder" class="py-4">
                        <svg class="mx-auto h-12 w-12 text-slate-400" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="0 0 24 24 3 3 0 013-3h12a3 3 0 013 3v12a3 3 0 01-3 3H6a3 3 0 01-3-3V9z M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <p class="text-slate-400 mt-2">Tap to capture meter photo</p>
                    </div>

                    <div id="previewContainer" class="hidden relative">
                        <img id="photoPreview" class="w-full h-48 object-cover rounded-md shadow-inner">
                        <div class="absolute top-2 right-2 bg-blue-600 text-white text-xs px-2 py-1 rounded shadow">
                            Change Photo</div>
                    </div>
                </div>
                <input type="hidden" name="media" id="base64Output">
            </div>




            <div class="flex items-center mt-2">
                <input type="checkbox" id="verifyCheck" required
                    class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                <label for="verifyCheck" class="ml-2 text-sm text-slate-700">
                    I confirm the above information is correct
                </label>
            </div>
           
            <button type="submit" id="submitBtn"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-200 transition-all transform active:scale-95 mt-4">
                Submit Request
            </button>



        </form>

        <div id="status" class="hidden mt-6 p-4 rounded-lg text-center font-medium"></div>
    </div>

    <script>
        // Replace with your Google Apps Script Web App URL

        const scriptURL = 'https://script.google.com/macros/s/AKfycbxQrunANM2Vyqo7AlTXR7_wmC3GIiNFp1CR9KfvTgpBxlB-s5CXDnNOy93mQcvRrfVz/exec';

        const form = document.getElementById('fuelForm');
        const photoInput = document.getElementById('photoInput');
        const photoPreview = document.getElementById('photoPreview');
        const previewContainer = document.getElementById('previewContainer');
        const photoPlaceholder = document.getElementById('photoPlaceholder');
        const base64Output = document.getElementById('base64Output');
        const status = document.getElementById('status');
        const btn = document.getElementById('submitBtn');

        // 1. Handle Photo Selection & Preview
        photoInput.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                // Check file size (optional but recommended for Google Sheets)
                if (file.size > 2 * 1024 * 1024) { // 2MB limit
                    alert("File is too large! Please use a smaller photo.");
                    this.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (event) {
                    photoPreview.src = event.target.result;

                    // Toggle visibility
                    previewContainer.classList.remove('hidden');
                    photoPlaceholder.classList.add('hidden');

                    // Store base64 data (only the part after the comma)
                    base64Output.value = event.target.result.split(',')[1];
                };
                reader.readAsDataURL(file);
            }
        });

        // 2. Handle Form Submission
        form.addEventListener('submit', e => {
            e.preventDefault();

            if (!base64Output.value) {
                showStatus("⚠️ Please capture a photo of the meter!", "bg-yellow-100 text-yellow-700");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = `
                <span class="flex items-center justify-center">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Uploading...
                </span>`;

            showStatus("Sending request to office...", "bg-blue-50 text-blue-700");

            // Create a FormData object from the form
            // Note: If sending to a Google Script that expects a simple object, 
            // you might need to convert FormData to a plain object.
            const formData = new FormData(form);

            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => {
                    showStatus("✅ Request Sent Successfully!", "bg-green-100 text-green-700");
                    resetForm();
                })
                .catch(error => {
                    showStatus("❌ Error: " + error.message, "bg-red-100 text-red-700");
                    btn.disabled = false;
                    btn.innerHTML = "Try Again";
                });
        });

        function resetForm() {
            form.reset();
            previewContainer.classList.add('hidden');
            photoPlaceholder.classList.remove('hidden');
            base64Output.value = "";
            btn.disabled = false;
            btn.innerHTML = "Submit Request";
        }

        function showStatus(msg, classes) {
            status.innerHTML = msg;
            status.className = "mt-6 p-4 rounded-lg text-center font-medium " + classes;
            status.classList.remove('hidden');
        }


    </script>
</body>

</html>